version: "2"
services:
  multiplexer:
    image: 192.168.99.1:5000/multiplexer
    build:
      context: .
      dockerfile: ./multiplexer/Dockerfile
    links:
      - redis
      - kafka
    environment:
      REDIS_HOST: redis
      ZOOKEEPER_HOST: kafka
      CONSUMER_GROUP: m1
  multiplexer-delivery:
    image: 192.168.99.1:5000/multiplexer-delivery
    build: multiplexer-delivery
    links:
      - redis
      - kafka
      - dse
    environment:
      REDIS_HOST: redis
      ZOOKEEPER_HOST: kafka
      DSE_HOST: dse
      DSE_KEYSPACE: testdb
      CONSUMER_GROUP: m1D
  l1r:
    image: 192.168.99.1:5000/l1r
    build: l1r
    links:
      - redis
      - kafka
    environment:
      REDIS_HOST: redis
      ZOOKEEPER_HOST: kafka 
      CONSUMER_GROUP: activities
  redis:
    image: redis
    ports:
      - 6379:6379
  kafka:
    image: 192.168.99.1:5000/spotify-kafka
    build: spotify-kafka/kafka
    environment:
      ADVERTISED_HOST: kafka
  dse:
    image: cassandra
  produce:
    image: 192.168.99.1:5000/capacity-test-data
    build: capacity-test-data
    links:
      - redis
      - kafka
    environment:
      NUMBER_OF_MESSAGES: 10000
      ZOOKEEPER_HOST: kafka
      REDIS_HOST: redis
      CONSUMER_GROUP: m1
  produce-multiplexer-delivery:
    image: 192.168.99.1:5000/capacity-test-data
    build: capacity-test-data
    links:
      - redis
      - kafka
    environment:
      NUMBER_OF_MESSAGES: 10000
      ZOOKEEPER_HOST: kafka
      REDIS_HOST: redis
      CONSUMER_GROUP: m1D
  produce-l1r:
    image: 192.168.99.1:5000/capacity-test-data
    build: capacity-test-data
    links:
      - redis
      - kafka
    environment:
      NUMBER_OF_MESSAGES: 10000
      ZOOKEEPER_HOST: kafka
      REDIS_HOST: redis
      CONSUMER_GROUP: activities
